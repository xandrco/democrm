<?php

namespace Database\Seeders;

use App\Models\Application;
use App\Models\Comment;
use App\Models\User;
use Carbon\Carbon;
use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

class CommentSeeder extends Seeder
{
    protected $comments = [
        'Связались с клиентом, ждём уточнений.',
        'Передано в технический отдел.',
        'Клиенту отправлено коммерческое предложение.',
        'Запрос не по адресу, перенаправлено.',
        'Проблема устранена, клиенту ответили.',
        'Ожидаем подтверждение от клиента.',
        'Заявка закрыта, клиент доволен.',
        'Связь не установлена, попробуем позже.',
        'Поставлено в очередь на проработку.',
        'Клиент просил перезвонить через неделю.',
        'Требуется дополнительная информация.',
        'Передано в отдел продаж.',
        'Назначена демонстрация на пятницу.',
        'Отправили инструкцию по e-mail.',
        'Обратились повторно — дали подробный ответ.',
        'Письмо доставлено, ждём реакции.',
        'Уточнение получено, продолжаем работу.',
        'От клиента получено согласие на внедрение.',
        'Заявка дублируется, предыдущая уже в работе.',
        'Проблема актуальна, передали разработчикам.',
        'Дали ссылку на видеоруководство.',
        'Предложили скидку — клиент заинтересован.',
        'Ждём ответа по расчёту стоимости.',
        'Переадресовано на менеджера региона.',
        'В процессе настройки. Клиент на связи.',
        'Уточнили детали. Переходим к КП.',
        'Назначен звонок на завтра.',
        'Уточнили технические детали.',
        'Клиент отказался — дорого.',
        'Отметили как приоритетную заявку.',
        'Нужно перезвонить после праздников.',
        'Клиенту предоставлен тестовый доступ.',
        'Согласован индивидуальный тариф.',
        'Перенесли встречу по просьбе клиента.',
        'Рассматривают альтернативные варианты.',
        'Обещали вернуться через неделю.',
        'Клиент просит выставить счёт.',
        'Ожидаем оплату.',
        'Сделано исключение по условиям.',
        'Вопрос решён, закрыли обращение.',
        'Запросили реквизиты организации.',
        'Выслали документы для подписи.',
        'Согласовали срок реализации.',
        'Запрос на интеграцию в работе.',
        'Ожидаем ответа от партнёра.',
        'Потребуется сопровождение внедрения.',
        'Дали контакты службы поддержки.',
        'Обратная связь положительная.',
        'Договор подписан, заявка завершена.',
        'Ошибка воспроизведена, в работе.',
        'Согласованы все этапы.',
        'Клиент уточнил детали — работает.',
        'Повторно обратились с тем же вопросом.',
        'Подготовили индивидуальное предложение.',
        'Клиенту не подходит функциональность.',
        'Заявка с выставки — высокая приоритетность.',
        'Проблема устранена после обновления.',
        'Потребовалась помощь программиста.',
        'Уточнили, что ошибка не на нашей стороне.',
        'Передано в бухгалтерию.',
        'Провели первичную консультацию.',
        'Ожидается демонстрация.',
        'Заявка с сайта, без контактного телефона.',
        'Клиент попросил отложить внедрение.',
        'Выслали презентацию и кейсы.',
        'Техническая ошибка — извинились.',
        'Запрос удовлетворён, результат отправлен.',
        'Не удалось дозвониться.',
        'Оставили голосовое сообщение.',
        'Назначен повторный контакт.',
        'Подтверждена заинтересованность.',
        'Письмо не доставлено, ошибка SMTP.',
        'Уточнили у клиента, нужна другая система.',
        'Отправили договор на согласование.',
        'Ждём ответ по техническому заданию.',
        'Оформлена пробная регистрация.',
        'Проблема воспроизведена, ждём фикса.',
        'Связались, перешли к переговорам.',
        'Запрос в очереди у аналитика.',
        'Отметили как потенциального клиента.',
        'Согласован график внедрения.',
        'Создана задача для техотдела.',
        'Обработка завершена, отправили отчёт.',
        'Согласованы детали по интеграции.',
        'Дали рекомендации по доработке сайта.',
        'Перенесли демонстрацию на следующую неделю.',
        'Оказали консультацию по выбору тарифа.',
        'Подтвердили, что всё работает.',
        'Проблема решена удалённо.',
        'Создана заявка в Jira.',
        'Отправили напоминание по почте.',
        'Произведена проверка логов.',
        'Сформирован план работ.',
        'Отправлен запрос на техподдержку.',
        'Заявка завершена успешно.',
        'Назначена личная встреча.',
        'Оставили заявку без изменений.',
        'Получено положительное заключение.',
        'Уточнили, клиент ушёл к конкурентам.',
        'Передали в партнёрскую сеть.',
        'Запросили скриншот ошибки.',
        'Вынесли задачу в план спринта.',
        'Созвонились, договорились о сотрудничестве.',
        'Добавили в список VIP-клиентов.',
        'Ожидается доставка оборудования.',
        'Обновили информацию по клиенту.',
        'Создали задачу на уточнение требований.',
        'Отправили напоминание клиенту.',
        'Клиент уточнил, что обращение не актуально.',
        'Запрос закрыт по инициативе клиента.',
        'Передано в саппорт на анализ.',
        'Клиент просит приоритетное рассмотрение.',
        'Добавлены дополнительные материалы.',
        'Клиент не вышел на связь.',
        'Ожидаем обратную связь с тестированием.',
        'Отправлено уточнение условий договора.',
        'Проблема с авторизацией — в работе.',
        'Согласованы условия поддержки.',
        'Клиент интересуется интеграцией с CRM.',
        'Назначен видеозвонок.',
        'Ожидается ответ службы безопасности.',
        'Переадресовано в legal-отдел.',
        'Проблема возникает только на мобильной версии.',
        'Запросили скан договора.',
        'Отказ по причине смены направления.',
        'Создали задачу на повторное сопровождение.',
        'Выставлен счёт на предоплату.',
        'Клиент в отпуске — ждём возвращения.',
        'Приняли в работу, назначен ответственный.',
        'Выслали спецификацию.',
        'Уточнение получено, заявка активирована.',
        'Созвонились, договорились о пилоте.',
        'Добавили заявку в еженедельный отчёт.',
        'Отправлен кейс с похожей ситуацией.',
        'Связались через Telegram.',
        'Подключили аналитика для консультации.',
        'Задали уточняющие вопросы.',
        'Клиент изменил контактное лицо.',
        'Заявка пересоздана с новыми данными.',
        'Уточнили особенности реализации.',
        'Передано в клиентский отдел.',
        'Создана памятка для клиента.',
        'Ожидается правка от заказчика.',
        'Заявка поставлена на контроль.',
        'Выяснили, что проблема в оборудовании.',
        'Переоткрыта после уточнений.',
        'Отправили тестовое письмо.',
        'Проверили на стороне клиента — всё работает.',
        'В работе у инженеров.',
        'Подтвердили согласие на условия.',
        'Назначена проверка функционала.',
        'Добавлены дополнительные контакты.',
        'Получено одобрение руководства.',
        'Клиент уточнил сроки запуска.',
        'Перенаправили запрос в филиал.',
        'Проведена диагностика — проблема локальна.',
        'Согласован акт выполненных работ.',
        'Ожидается выход новой версии.',
        'Клиент запросил отчёт по активности.',
        'Запланирован следующий этап.',
        'Требуется выезд специалиста.',
        'Оформлена заявка на техническое задание.',
        'Ожидаем подтверждения встречи.',
        'Добавлен в CRM с пометкой “горячий”.',
        'Уточнили планируемый объём работ.',
        'Выставили повторный счёт.',
        'Проведена очная встреча.',
        'Передали в отдел интеграций.',
        'Создали карточку клиента с новыми реквизитами.',
        'Проблема оказалась в стороннем сервисе.',
        'Назначено время подключения.',
        'Получено разрешение на работу с данными.',
        'Переслали запрос в подрядной организации.',
        'Клиент просит демо на нескольких пользователей.',
        'Вопрос требует согласования SLA.',
        'Назначен дополнительный менеджер.',
        'Переведено на обслуживание другого офиса.',
        'Добавлены вложения к заявке.',
        'Отмечено как повторное обращение.',
        'Выяснили, что это тестовая заявка.',
        'Запрос требует согласования бюджета.',
        'Клиент выразил благодарность.',
        'Уточнили план-график проекта.',
        'Подключён внешний консультант.',
        'Требуется проверка прав доступа.',
        'Проведён анализ обращения.',
        'Подготовлено письмо с предложением.',
        'Результат обсуждения — отказ от внедрения.',
        'Передали кейс в базу знаний.',
        'Переподключили к новой платформе.',
        'Получено официальное письмо.',
        'Добавили информацию о конкурентах.',
        'Письмо подписано ЭЦП.',
        'Уточнили, что клиент перешёл в другой сегмент.',
        'Запрос переведён в “На паузе”.',
        'Открыли тикет в HelpDesk.',
        'Заявка требует правок в UI.',
        'Требуется миграция данных.',
        'Переписка завершена.',
        'Перенесли рассмотрение на следующий спринт.',
        'Добавили чек-лист по запросу.',
        'Клиент хочет пилот на 1 месяц.',
        'Запрос принят, начата разработка.',
        'Передали отзыв руководству.',
        'Добавлен к регулярной отчётности.',
        'Обновлён статус по просьбе клиента.',
        'Заявка в отложенных до уточнения целей.'
    ];

    public function run(): void
    {
        $users = User::all();
        $applications = Application::all();
        
        $commentCount = 0;
        
        foreach ($applications as $application) {
            $numComments = rand(0, 3);
            
            if ($commentCount >= 200) {
                break;
            }
            
            if ($commentCount + $numComments > 200) {
                $numComments = 200 - $commentCount;
            }
            
            for ($i = 0; $i < $numComments; $i++) {
                $commentText = $this->comments[array_rand($this->comments)];
                
                Comment::create([
                    'application_id' => $application->id,
                    'user_id' => $users->random()->id,
                    'comment' => $commentText,
                    'created_at' => Carbon::now()->subDays(rand(0, 30))->subHours(rand(1, 23)),
                    'updated_at' => Carbon::now()->subDays(rand(0, 30))->subHours(rand(1, 23)),
                ]);
                
                $commentCount++;
            }
        }
    }
}
